<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>Storage</title>
  </head>
  <body>
    <header>
      <div class="header-content">
        <h1><a href="/storage" style="text-decoration: none">Storage</a></h1>
        <a href="/logout" style="text-decoration: none">
          <button class="logout-button">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              class="icon logout-icon"
              fill="currentColor"
            >
              <title>logout</title>
              <path
                d="M17 7L15.59 8.41L18.17 11H8V13H18.17L15.59 15.58L17 17L22 12M4 5H12V3H4C2.9 3 2 3.9 2 5V19C2 20.1 2.9 21 4 21H12V19H4V5Z"
              />
            </svg>
          </button>
        </a>
      </div>
    </header>

    <div class="storage-content">
      <aside>
        <div class="actions">
          <button
            onclick="(document.querySelector('.new-folder-modal').showModal())"
            class="action"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="icon"
            >
              <path
                d="M13 19C13 19.34 13.04 19.67 13.09 20H4C2.9 20 2 19.11 2 18V6C2 4.89 2.89 4 4 4H10L12 6H20C21.1 6 22 6.89 22 8V13.81C21.39 13.46 20.72 13.22 20 13.09V8H4V18H13.09C13.04 18.33 13 18.66 13 19M20 18V15H18V18H15V20H18V23H20V20H23V18H20Z"
              />
            </svg>
            New Folder
          </button>
          <button
            onclick="(document.querySelector('.new-file-modal').showModal())"
            class="action"
          >
            <svg
              class="icon"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path
                d="M13.81 22H6C4.89 22 4 21.11 4 20V4C4 2.9 4.89 2 6 2H14L20 8V13.09C19.67 13.04 19.34 13 19 13S18.33 13.04 18 13.09V9H13V4H6V20H13.09C13.21 20.72 13.46 21.39 13.81 22M23 18H20V15H18V18H15V20H18V23H20V20H23V18Z"
              />
            </svg>
            Upload File
          </button>
        </div>
      </aside>

      <main><%- include('folderRoute.ejs') %> <%- include('files.ejs') %></main>
    </div>

    <div class="error-message hidden">
      <p class="error"></p>
    </div>

    <dialog class="new-file-modal">
      <div class="modal-content">
        <h2>New File</h2>
        <form
          action="/new-file?folder=<%= locals.folder.id %>"
          method="POST"
          enctype="multipart/form-data"
          class="file-form"
        >
          <input
            type="file"
            id="file"
            name="file"
            class="file-input"
            minlength="1"
            required
          />
          <button class="submit-button">Upload File</button>
        </form>
        <button
          class="close-button"
          onclick="document.querySelector('.new-file-modal').close()"
        >
          &#10005;
        </button>
      </div>
    </dialog>

    <dialog class="new-folder-modal">
      <div class="modal-content">
        <h2>New Folder</h2>
        <form
          action="/new-folder?folder=<%= locals.folder.id %>"
          method="POST"
          class="folder-form"
        >
          <div class="folder-name-input">
            <label for="folder">Name:</label>
            <input
              type="text"
              id="folder"
              name="folder"
              minlength="1"
              required
            />
          </div>
          <button class="submit-button">Create Folder</button>
        </form>
        <button
          class="close-button"
          onclick="document.querySelector('.new-folder-modal').close()"
        >
          &#10005;
        </button>
      </div>
    </dialog>
  </body>

  <script>
    function showErrorMessage(show) {
      if (show) {
        document.querySelector(".error-message").classList.remove("hidden");
        document.querySelector(".error").textContent =
          "There is already a file/folder with this name in this directory.";

        setTimeout(() => {
          document.querySelector(".error-message").classList.add("hidden");
        }, 5000);
      }
    }

    showErrorMessage(<%= locals.invalidName %>);
  </script>
</html>
